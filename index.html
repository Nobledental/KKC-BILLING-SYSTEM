<!DOCTYPE html>
<html lang="en" data-theme="light">
  <!-- jsPDF + AutoTable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<!-- QR Code -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<!-- JsBarcode -->
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>KCC Billing OS — SPA</title>

  <link rel="stylesheet" href="style.css">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css">

  <!-- Scripts -->
  <script defer src="data/tariffs.js"></script>
  <script defer src="app.js"></script>
</head>

<body>

<!-- ============================================================
     MAIN APP WRAPPER
============================================================ -->
<div class="app-wrapper">

  <!-- ============================================================
       COLLAPSIBLE SIDEBAR
  ============================================================= -->
  <aside class="sidebar collapsed" id="sidebar">

    <div class="sidebar-logo">
      <img src="assets/logo.png" alt="KCC" class="sidebar-logo-img">
      <span class="sidebar-logo-text">KCC Billing OS</span>
    </div>

    <nav class="sidebar-nav">

      <button class="nav-item" data-target="panel-dashboard">
        <i class="ri-dashboard-line"></i>
        <span>Dashboard</span>
      </button>

      <button class="nav-item" data-target="panel-newbill">
        <i class="ri-file-add-line"></i>
        <span>New Bill</span>
      </button>

      <button class="nav-item" data-target="panel-tariff">
        <i class="ri-price-tag-3-line"></i>
        <span>Tariff Master</span>
      </button>

      <button class="nav-item" data-target="panel-history">
        <i class="ri-history-line"></i>
        <span>Bill History</span>
      </button>

      <button class="nav-item" data-target="panel-settings">
        <i class="ri-settings-3-line"></i>
        <span>Settings</span>
      </button>

    </nav>

    <!-- Sidebar Toggle -->
    <button id="sidebarToggle" class="sidebar-toggle">
      <i class="ri-arrow-right-s-line"></i>
    </button>

  </aside>



  <!-- ============================================================
       TOPBAR
  ============================================================= -->
  <header class="topbar">
    <div class="topbar-left">
      <h1 class="topbar-title">Krishna Kidney Centre — Billing OS</h1>
    </div>

    <div class="topbar-right">

      <!-- DARK / LIGHT MODE TOGGLE -->
      <button id="themeToggle" class="topbar-btn">
        <i class="ri-sun-line" id="theme-icon"></i>
      </button>

      <!-- USER Icon -->
      <div class="topbar-user">
        <i class="ri-user-3-line"></i>
      </div>

    </div>
  </header>



  <!-- ============================================================
       MAIN PANEL CONTAINER (CONTENT SWITCHER)
  ============================================================= -->
  <main class="main-panel">

    <!-- Panels will appear here. In next messages, I will fill them. -->

<!-- DASHBOARD PANEL -->
<section id="panel-dashboard" class="panel active">

  <h2 class="panel-title">Dashboard Overview</h2>

  <!-- ============================================================
       DASHBOARD — TOP CARDS
  ============================================================= -->
  <div class="dashboard-cards">

    <div class="dash-card">
      <div class="dash-card-icon"><i class="ri-file-list-3-line"></i></div>
      <div class="dash-card-content">
        <h3 id="dash-total-bills">0</h3>
        <p>Total Bills</p>
      </div>
    </div>

    <div class="dash-card">
      <div class="dash-card-icon"><i class="ri-money-rupee-circle-line"></i></div>
      <div class="dash-card-content">
        <h3 id="dash-total-revenue">₹0</h3>
        <p>Total Revenue</p>
      </div>
    </div>

    <div class="dash-card">
      <div class="dash-card-icon"><i class="ri-error-warning-line"></i></div>
      <div class="dash-card-content">
        <h3 id="dash-total-pending">₹0</h3>
        <p>Pending Amount</p>
      </div>
    </div>

    <div class="dash-card">
      <div class="dash-card-icon"><i class="ri-stethoscope-line"></i></div>
      <div class="dash-card-content">
        <h3 id="dash-surgical-cases">0</h3>
        <p>Surgical Cases</p>
      </div>
    </div>

  </div>



  <!-- ============================================================
       DASHBOARD — CHARTS SECTION
  ============================================================= -->
  <div class="dashboard-charts">

    <div class="chart-box">
      <h3>Revenue Trend</h3>
      <canvas id="chartRevenue"></canvas>
    </div>

    <div class="chart-box">
      <h3>Payment Mode Breakdown</h3>
      <canvas id="chartPaymentModes"></canvas>
    </div>

    <div class="chart-box">
      <h3>Surgery vs Non-Surgery</h3>
      <canvas id="chartSurgery"></canvas>
    </div>

  </div>



  <!-- ============================================================
       DASHBOARD — QUICK ACTIONS
  ============================================================= -->
  <div class="dashboard-actions">

    <button class="action-btn" data-target="panel-newbill">
      <i class="ri-add-circle-line"></i> Create New Bill
    </button>

    <button class="action-btn" data-target="panel-tariff">
      <i class="ri-price-tag-3-line"></i> Tariff Master
    </button>

    <div class="search-bill">
      <input type="text" id="searchBillInput" placeholder="Search 12-digit Bill Number...">
      <button id="searchBillBtn"><i class="ri-search-line"></i></button>
    </div>

  </div>



  <!-- ============================================================
       DASHBOARD — ALERTS
  ============================================================= -->
  <div class="dashboard-alerts">
    <h3>Alerts</h3>

    <ul id="alertList">
      <!-- Alerts injected dynamically -->
    </ul>

  </div>

</section>


<!-- ============================================================
     NEW BILL PANEL — TWO COLUMN PROFESSIONAL LAYOUT
============================================================ -->
<section id="panel-newbill" class="panel">

  <h2 class="panel-title">Create Patient Final Bill</h2>

  <div class="bill-wrapper">

    <!-- ============================================================
         LEFT COLUMN (30%) — PATIENT & ADMISSION DETAILS
    ============================================================= -->
    <div class="bill-left">

      <div class="form-section">
        <h3>Patient Details</h3>

        <label>Patient Name</label>
        <input type="text" id="pt_name">

        <label>IP Number / Patient ID</label>
        <input type="text" id="pt_id">

        <div class="two-input">
          <div>
            <label>Age</label>
            <input type="number" id="pt_age">
          </div>
          <div>
            <label>Gender</label>
            <select id="pt_gender">
              <option value="">--</option>
              <option>Male</option>
              <option>Female</option>
              <option>Other</option>
            </select>
          </div>
        </div>

        <label>Address</label>
        <textarea id="pt_address"></textarea>

      </div>


      <div class="form-section">
        <h3>Admission Details</h3>

        <label>Department</label>
        <input type="text" id="pt_dept">

        <label>Consultant Doctor</label>
        <input type="text" id="pt_doctor">

        <label>Admission Date</label>
        <input type="date" id="admit_date">

        <label>Discharge Date</label>
        <input type="date" id="discharge_date">

        <div class="two-input">
          <div>
            <label>Length of Stay (Auto)</label>
            <input type="text" id="los" disabled>
          </div>
          <div>
            <label>Room Type</label>
            <select id="room_type">
              <option value="">Select Room</option>
            </select>
          </div>
        </div>

      </div>


      <div class="form-section">
        <h3>Insurance / Corporate</h3>

        <label>Insurance?</label>
        <select id="insurance_flag">
          <option value="no">No</option>
          <option value="yes">Yes</option>
        </select>

        <label>Policy / Corporate Name</label>
        <input type="text" id="insurance_name">

        <label>Approval / Claim Number</label>
        <input type="text" id="insurance_claim">

      </div>

    </div> <!-- END LEFT COLUMN -->



    <!-- ============================================================
         RIGHT COLUMN (70%) — BILLING WORKSPACE
    ============================================================= -->
    <div class="bill-right">



      <!-- =======================================================
           ROOM & DAILY CHARGES
      ======================================================= -->
      <div class="bill-section">
        <div class="bill-section-header">
          <h3>Room & Daily Charges</h3>
          <button class="section-toggle"><i class="ri-arrow-down-s-line"></i></button>
        </div>

        <div class="bill-section-body">

          <label>Room Rent / day</label>
          <input type="number" id="room_rent" disabled>

          <label>Nursing Charges / day</label>
          <input type="number" id="nursing_charge" disabled>

          <label>Duty Doctor / day</label>
          <input type="number" id="duty_charge" disabled>

          <label>Consultant Visit Charge (per visit)</label>
          <input type="number" id="consultant_charge" disabled>

        </div>
      </div>



      <!-- =======================================================
           CONSULTANT VISITS
      ======================================================= -->
      <div class="bill-section">
        <div class="bill-section-header">
          <h3>Consultant Visits</h3>
          <button id="addVisitBtn" class="mini-add-btn"><i class="ri-add-line"></i></button>
        </div>

        <div class="bill-section-body" id="visitList">
          <!-- Visits injected via JS -->
        </div>
      </div>



      <!-- =======================================================
           SURGERIES — MULTI-SURGERY MODULE
      ======================================================= -->
      <div class="bill-section">
        <div class="bill-section-header">
          <h3>Surgical Procedures</h3>
          <button id="addSurgeryBtn" class="mini-add-btn"><i class="ri-add-line"></i></button>
        </div>

        <div class="bill-section-body" id="surgeryList">
          <!-- Surgeries injected via JS -->
        </div>
      </div>



      <!-- =======================================================
           PHARMACY (CONSOLIDATED)
      ======================================================= -->
      <div class="bill-section">
        <div class="bill-section-header">
          <h3>Pharmacy Charges</h3>
          <button id="togglePharmacyBreakup" class="mini-toggle-btn">
            <i class="ri-arrow-down-s-line"></i>
          </button>
        </div>

        <div class="bill-section-body">
          <label>Total Pharmacy Amount</label>
          <input type="number" id="pharmacy_total">

          <!-- Collapsible Breakup -->
          <div id="pharmacyBreakup" class="collapsible hidden">

            <table class="table">
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Qty</th>
                  <th>Amount</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="pharmacyBreakupBody"></tbody>
            </table>

            <button id="addPharmacyItem" class="mini-add-btn"><i class="ri-add-line"></i> Add Item</button>

          </div>

        </div>
      </div>



      <!-- =======================================================
           INVESTIGATIONS
      ======================================================= -->
      <div class="bill-section">
        <div class="bill-section-header">
          <h3>Investigations</h3>
          <button id="addInvestigationBtn" class="mini-add-btn"><i class="ri-add-line"></i></button>
        </div>

        <div class="bill-section-body">

          <table class="table">
            <thead>
              <tr>
                <th>Investigation</th>
                <th>Amount</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="investigationList"></tbody>
          </table>

        </div>
      </div>



      <!-- =======================================================
           MISCELLANEOUS ITEMS
      ======================================================= -->
      <div class="bill-section">
        <div class="bill-section-header">
          <h3>Miscellaneous Charges</h3>
          <button id="addMiscBtn" class="mini-add-btn"><i class="ri-add-line"></i></button>
        </div>

        <div class="bill-section-body">
          <table class="table">
            <thead>
              <tr>
                <th>Description</th>
                <th>Amount</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="miscList"></tbody>
          </table>
        </div>
      </div>



      <!-- =======================================================
           RECEIPTS (MULTI-PAYMENTS)
      ======================================================= -->
      <div class="bill-section">
        <div class="bill-section-header">
          <h3>Receipts</h3>
          <button id="addReceiptBtn" class="mini-add-btn"><i class="ri-add-line"></i></button>
        </div>

        <div class="bill-section-body">
          <table class="table">
            <thead>
              <tr>
                <th>Receipt No</th>
                <th>Date</th>
                <th>Mode</th>
                <th>Amount</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="receiptList"></tbody>
          </table>
        </div>
      </div>



      <!-- =======================================================
           BILL SUMMARY
      ======================================================= -->
      <div class="bill-summary">

        <h3>Final Summary</h3>

        <div class="summary-grid">
          <div>
            <label>Gross Amount</label>
            <input type="text" id="gross_amount" disabled>
          </div>

          <div>
            <label>Total Receipts</label>
            <input type="text" id="total_receipts" disabled>
          </div>

          <div>
            <label>Balance</label>
            <input type="text" id="balance_amount" disabled>
          </div>
        </div>

        <div class="two-input">
          <div>
            <label>Bill Number (Auto 12-digit)</label>
            <input type="text" id="bill_no" disabled>
          </div>
          <div>
            <button id="generateBillNo" class="btn">Generate Bill No</button>
          </div>
        </div>

        <button id="generatePDF" class="btn primary-btn">
          <i class="ri-printer-line"></i> Export A4 PDF
        </button>

      </div>


    </div> <!-- END RIGHT COLUMN -->

  </div> <!-- END bill-wrapper -->

</section>

<!-- ============================================================
     TARIFF MASTER PANEL — PROFESSIONAL ADMIN DASHBOARD
============================================================ -->
<section id="panel-tariff" class="panel">

  <h2 class="panel-title">Tariff Master</h2>

  <div class="tariff-wrapper">



    <!-- ======================================================
         TOP BAR — GLOBAL SEARCH + IMPORT/EXPORT
    ====================================================== -->
    <div class="tariff-topbar">

      <input type="text" id="tariffSearch" placeholder="Search tariff...">

      <div class="tariff-actions">
        <button id="exportTariff" class="btn small-btn">
          <i class="ri-download-cloud-line"></i> Export JSON
        </button>

        <label class="btn small-btn import-btn">
          <i class="ri-upload-cloud-line"></i> Import JSON
          <input type="file" id="importTariffFile" hidden>
        </label>
      </div>

    </div>



    <!-- ======================================================
         ROOM & DAILY CHARGES
    ====================================================== -->
    <div class="tariff-block">
      <div class="tariff-block-header">
        <h3>Room & Daily Charges</h3>
        <button class="section-toggle"><i class="ri-arrow-down-s-line"></i></button>
      </div>

      <div class="tariff-block-body">

        <table class="table tariff-table">
          <thead>
            <tr>
              <th>Room Type</th>
              <th>Room Rent / Day</th>
              <th>Nursing / Day</th>
              <th>Duty Doctor / Day</th>
              <th>Consultant / Visit</th>
            </tr>
          </thead>
          <tbody id="tariffRoomTable">
            <!-- Loaded from tariffs.js -->
          </tbody>
        </table>

      </div>
    </div>




    <!-- ======================================================
         SURGICAL PROCEDURES (COLLAPSIBLE CATEGORIES)
    ====================================================== -->
    <div class="tariff-block">
      <div class="tariff-block-header">
        <h3>Surgical Procedures</h3>
      </div>

      <div class="tariff-block-body">



        <!-- ENT -->
        <div class="tariff-category">
          <div class="tariff-category-header">
            <h4>ENT</h4>
            <button class="section-toggle"><i class="ri-arrow-down-s-line"></i></button>
          </div>
          <div class="tariff-category-body" id="tariffEnt"></div>
        </div>


        <!-- ORTHO -->
        <div class="tariff-category">
          <div class="tariff-category-header">
            <h4>Orthopaedics</h4>
            <button class="section-toggle"><i class="ri-arrow-down-s-line"></i></button>
          </div>
          <div class="tariff-category-body" id="tariffOrtho"></div>
        </div>


        <!-- UROLOGY -->
        <div class="tariff-category">
          <div class="tariff-category-header">
            <h4>Urology</h4>
            <button class="section-toggle"><i class="ri-arrow-down-s-line"></i></button>
          </div>
          <div class="tariff-category-body" id="tariffUro"></div>
        </div>


        <!-- GENERAL SURGERY -->
        <div class="tariff-category">
          <div class="tariff-category-header">
            <h4>General Surgery</h4>
            <button class="section-toggle"><i class="ri-arrow-down-s-line"></i></button>
          </div>
          <div class="tariff-category-body" id="tariffGen"></div>
        </div>


        <!-- OBGY -->
        <div class="tariff-category">
          <div class="tariff-category-header">
            <h4>Obstetrics & Gynecology</h4>
            <button class="section-toggle"><i class="ri-arrow-down-s-line"></i></button>
          </div>
          <div class="tariff-category-body" id="tariffObgy"></div>
        </div>


        <!-- CARDIAC -->
        <div class="tariff-category">
          <div class="tariff-category-header">
            <h4>Cardiac</h4>
            <button class="section-toggle"><i class="ri-arrow-down-s-line"></i></button>
          </div>
          <div class="tariff-category-body" id="tariffCardiac"></div>
        </div>


        <!-- OPHTHALMOLOGY -->
        <div class="tariff-category">
          <div class="tariff-category-header">
            <h4>Ophthalmology</h4>
            <button class="section-toggle"><i class="ri-arrow-down-s-line"></i></button>
          </div>
          <div class="tariff-category-body" id="tariffOpthal"></div>
        </div>

      </div>
    </div>




    <!-- ======================================================
         INVESTIGATIONS TARIFF
    ====================================================== -->
    <div class="tariff-block">
      <div class="tariff-block-header">
        <h3>Investigations</h3>
        <button id="addInvestigationTariff" class="mini-add-btn"><i class="ri-add-line"></i></button>
      </div>

      <div class="tariff-block-body">
        <table class="table tariff-table">
          <thead>
            <tr>
              <th>Investigation Name</th>
              <th>Price (₹)</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tariffInvestigationTable"></tbody>
        </table>
      </div>
    </div>




    <!-- ======================================================
         CREATE NEW SURGICAL PROCEDURE (MODAL INVOCATION)
    ====================================================== -->
    <button id="addSurgeryTariff" class="btn primary-btn">
      <i class="ri-add-circle-line"></i> Add New Surgical Procedure
    </button>



  </div> <!-- END tariff-wrapper -->

</section>


    <!-- BILL HISTORY PANEL -->
    <section id="panel-history" class="panel">
      <!-- Filled later -->
    </section>

    <!-- SETTINGS PANEL -->
    <section id="panel-settings" class="panel">
      <h2 class="panel-title">Settings</h2>
      <p>Light/Dark Mode, Data Export, etc.</p>
    </section>

  </main>

</div> <!-- END app-wrapper -->

<!-- ============================================================
     MODAL CONTAINER (used for surgeries, receipts, etc.)
============================================================ -->
<div id="modal-container" class="modal-container hidden"></div>


<!-- ============================================================
     SLIDING DRAWER MODALS (RIGHT SIDE)
============================================================ -->
<div id="drawer-backdrop" class="drawer-backdrop hidden"></div>

<div id="drawer" class="drawer hidden">

  <!-- Drawer Header -->
  <div class="drawer-header">
    <h3 id="drawer-title">Drawer Title</h3>
    <button id="drawer-close" class="drawer-close">
      <i class="ri-close-line"></i>
    </button>
  </div>

  <!-- Drawer Content Area -->
  <div id="drawer-content" class="drawer-content">
    <!-- Dynamic content populated by app.js -->
  </div>

</div>
<!-- ===================================================================
     SURGERY FORM TEMPLATE (DRAWER)
=================================================================== -->
<template id="tpl-surgery-form">
  <div class="drawer-form">

    <label>Surgery Name</label>
    <select id="surg_name"></select>

    <label>OT Charges</label>
    <input type="number" id="surg_ot">

    <label>Surgeon Charges</label>
    <input type="number" id="surg_surgeon">

    <label>Assistant Charges</label>
    <input type="number" id="surg_assistant">

    <label>Anesthetist Charges</label>
    <input type="number" id="surg_anes">

    <label>Implant Charges</label>
    <input type="number" id="surg_implant">

    <label>OT Gas Charges</label>
    <input type="number" id="surg_gas">

    <label>Consumables</label>
    <input type="number" id="surg_cons">

    <label>Discount Mode</label>
    <select id="surg_mode">
      <option value="none">No Discount</option>
      <option value="50">50% Package</option>
      <option value="custom">Custom %</option>
    </select>

    <label id="lbl_surg_custom" class="hidden">Custom Discount (%)</label>
    <input id="surg_custom" class="hidden" type="number" placeholder="Enter %">

    <button id="saveSurgery" class="btn primary-btn full">Save Surgery</button>
  </div>
</template>



<!-- ===================================================================
     INVESTIGATION FORM TEMPLATE
=================================================================== -->
<template id="tpl-investigation-form">
  <div class="drawer-form">
    <label>Investigation Name</label>
    <input type="text" id="inv_name">

    <label>Amount</label>
    <input type="number" id="inv_amount">

    <button id="saveInvestigation" class="btn primary-btn full">Save Investigation</button>
  </div>
</template>



<!-- ===================================================================
     PHARMACY ITEM TEMPLATE
=================================================================== -->
<template id="tpl-pharmacy-item">
  <div class="drawer-form">
    <label>Item Name</label>
    <input type="text" id="pharm_item">

    <label>Qty</label>
    <input type="number" id="pharm_qty">

    <label>Amount</label>
    <input type="number" id="pharm_amt">

    <button id="savePharmacyItem" class="btn primary-btn full">Save Item</button>
  </div>
</template>



<!-- ===================================================================
     MISC ITEM TEMPLATE
=================================================================== -->
<template id="tpl-misc-item">
  <div class="drawer-form">
    <label>Description</label>
    <input type="text" id="misc_desc">

    <label>Amount</label>
    <input type="number" id="misc_amt">

    <button id="saveMiscItem" class="btn primary-btn full">Save Item</button>
  </div>
</template>



<!-- ===================================================================
     RECEIPT FORM TEMPLATE
=================================================================== -->
<template id="tpl-receipt-form">
  <div class="drawer-form">
    <label>Receipt Number</label>
    <input type="text" id="rec_no">

    <label>Date</label>
    <input type="date" id="rec_date">

    <label>Mode</label>
    <select id="rec_mode">
      <option>Cash</option>
      <option>UPI</option>
      <option>Card</option>
      <option>Online Transfer</option>
      <option>Insurance</option>
    </select>

    <label>Amount</label>
    <input type="number" id="rec_amt">

    <button id="saveReceipt" class="btn primary-btn full">Save Receipt</button>
  </div>
</template>



<!-- ===================================================================
     DELETE CONFIRM
=================================================================== -->
<template id="tpl-confirm-delete">
  <div class="drawer-form">
    <p style="margin-bottom:20px;font-size:16px;">Are you sure you want to delete this entry?</p>
    <button id="confirmDeleteYes" class="btn danger-btn full">Yes, Delete</button>
    <button id="confirmDeleteNo" class="btn full">Cancel</button>
  </div>
</template>
  
<svg id="barcodeSvg" style="display:none;"></svg>

</body>
</html>
